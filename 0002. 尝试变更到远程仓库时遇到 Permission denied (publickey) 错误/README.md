# 0002. å°è¯•å˜æ›´åˆ°è¿œç¨‹ä»“åº“æ—¶é‡åˆ° Permission denied (publickey) é”™è¯¯

## ğŸ“’ notes - é”™è¯¯ç¤ºä¾‹

```bash
$ git push -u origin main
git@github.com: Permission denied (publickey).
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
```

## ğŸ¤– AI - å°è¯•å°†ä»£ç æ¨é€åˆ° GitHub æ—¶é‡åˆ° Permission denied (publickey). é”™è¯¯ï¼Œåº”è¯¥å¦‚ä½•è§£å†³ï¼Ÿ

å½“ä½ å°è¯•å°†ä»£ç æ¨é€åˆ° GitHub æ—¶é‡åˆ° `Permission denied (publickey).` é”™è¯¯ï¼Œè¿™é€šå¸¸æ„å‘³ç€ä½ çš„ SSH å¯†é’¥æ²¡æœ‰è¢«æ­£ç¡®é…ç½®æˆ–è€…æ²¡æœ‰è¢«æ·»åŠ åˆ° GitHub è´¦æˆ·ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›è§£å†³è¿™ä¸ªé—®é¢˜çš„æ­¥éª¤ï¼š

1. **æ£€æŸ¥æ˜¯å¦å·²ç»ç”Ÿæˆäº† SSH å¯†é’¥**ï¼š
   æ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹ç°æœ‰çš„ SSH å¯†é’¥ã€‚
   ```bash
   ls -al ~/.ssh
   ```

2. **å¦‚æœæ²¡æœ‰ SSH å¯†é’¥ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„**ï¼š
   å¦‚æœä½ æ²¡æœ‰çœ‹åˆ°ä»»ä½• `.pub` æ–‡ä»¶ï¼ˆä¾‹å¦‚ `id_rsa.pub` æˆ– `id_ed25519.pub`ï¼‰ï¼Œä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªæ–°çš„ SSH å¯†é’¥å¯¹ã€‚
   ```bash
   ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
   ```
   æŒ‰ç…§æç¤ºæ“ä½œï¼Œå¯ä»¥é€‰æ‹©ä¿å­˜ä½ç½®å’Œè®¾ç½®å¯†ç ã€‚

3. **å°† SSH å…¬é’¥æ·»åŠ åˆ° GitHub**ï¼š
   å°†æ–°ç”Ÿæˆçš„å…¬é’¥å†…å®¹å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚
   ```bash
   cat ~/.ssh/id_rsa.pub
   # æˆ–è€…å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ ed25519
   cat ~/.ssh/id_ed25519.pub
   ```
   ç™»å½•åˆ°ä½ çš„ GitHub è´¦æˆ·ï¼Œè¿›å…¥ Settings -> SSH and GPG keys é¡µé¢ï¼Œç‚¹å‡» New SSH key æŒ‰é’®ï¼Œç²˜è´´ä½ çš„å…¬é’¥ï¼Œå¹¶ä¿å­˜ã€‚

4. **æµ‹è¯• SSH è¿æ¥**ï¼š
   åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æµ‹è¯•ä¸ GitHub çš„è¿æ¥ã€‚
   ```bash
   ssh -T git@github.com
   ```
   å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ ä¼šçœ‹åˆ°ä¸€æ¡æ¬¢è¿ä¿¡æ¯ï¼Œè¯´æ˜ä½ å·²ç»æˆåŠŸé€šè¿‡ SSH è®¤è¯ã€‚

5. **ç¡®ä¿è¿œç¨‹ URL æ­£ç¡®**ï¼š
   ç¡®è®¤ä½ çš„ä»“åº“è¿œç¨‹ URL æ˜¯æ­£ç¡®çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰çš„è¿œç¨‹ URLã€‚
   ```bash
   git remote -v
   ```
   å¦‚æœ URL ä¸æ­£ç¡®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¿®æ”¹å®ƒã€‚
   ```bash
   git remote set-url origin git@github.com:Tdahuyou/algorithm_.git
   ```

6. **å†æ¬¡å°è¯•æ¨é€**ï¼š
   å½“æ‰€æœ‰è®¾ç½®éƒ½å®Œæˆåï¼Œå†æ¬¡å°è¯•æ¨é€ä»£ç ã€‚
   ```bash
   git push -u origin main
   ```

å¦‚æœä¸Šè¿°æ­¥éª¤ä¹‹åé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·ç¡®ä¿ä½ çš„ SSH ä»£ç†æ­£åœ¨è¿è¡Œå¹¶ä¸”ä½ çš„å¯†é’¥å·²ç»è¢«æ·»åŠ åˆ° SSH ä»£ç†ä¸­ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ SSH ä»£ç†å¹¶æ·»åŠ å¯†é’¥ã€‚
```bash
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_rsa
# æˆ–è€…
ssh-add ~/.ssh/id_ed25519
```

å¦‚æœè¿˜æ˜¯æ— æ³•è§£å†³é—®é¢˜ï¼Œå¯èƒ½éœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–å®‰å…¨è½¯ä»¶æˆ–ç½‘ç»œè®¾ç½®é˜»æ­¢äº† SSH è¿æ¥ã€‚

## ğŸ¤– AI - æäº¤çš„é—®é¢˜è§£å†³äº†ï¼Œå¯æ˜¯æˆ‘ç°åœ¨æ¯æ¬¡ push éƒ½éœ€è¦è¾“å…¥ Enter passphrase for key '/Users/huyouda/.ssh/id_rsa':

å½“ä½ æ¯æ¬¡ä½¿ç”¨ SSH å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯æ—¶éƒ½éœ€è¦è¾“å…¥å¯†ç çŸ­è¯­ï¼ˆpassphraseï¼‰ï¼Œè¿™æ˜¯å› ä¸ºä½ çš„ç§é’¥è¢«ä¿æŠ¤äº†ï¼Œä»¥å¢åŠ å®‰å…¨æ€§ã€‚å¦‚æœä½ å¸Œæœ›é¿å…æ¯æ¬¡éƒ½è¾“å…¥å¯†ç çŸ­è¯­ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š

### 1. ä½¿ç”¨ `ssh-agent`
`ssh-agent` æ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨äºç®¡ç†ä½ çš„ SSH å¯†é’¥å’Œå¯†ç çŸ­è¯­ã€‚ä½ å¯ä»¥å°†å¯†é’¥æ·»åŠ åˆ° `ssh-agent` ä¸­ï¼Œå¹¶åœ¨ä¼šè¯æœŸé—´è‡ªåŠ¨å¤„ç†è®¤è¯è¿‡ç¨‹ã€‚

#### å¯åŠ¨ `ssh-agent` å¹¶æ·»åŠ å¯†é’¥
é¦–å…ˆï¼Œç¡®ä¿ `ssh-agent` æ­£åœ¨è¿è¡Œã€‚ä½ å¯ä»¥åœ¨ç»ˆç«¯ä¸­å¯åŠ¨å®ƒï¼š
```bash
eval "$(ssh-agent -s)"
```

ç„¶åï¼Œå°†ä½ çš„ç§é’¥æ·»åŠ åˆ° `ssh-agent` ä¸­ï¼š
```bash
ssh-add -K ~/.ssh/id_rsa
# å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ ed25519 å¯†é’¥ï¼Œåˆ™ä¸º
# ssh-add -K ~/.ssh/id_ed25519
```

`-K` å‚æ•°ä¼šå°†å¯†ç çŸ­è¯­ä¿å­˜åˆ° macOS çš„ Keychain ä¸­ï¼Œè¿™æ ·åœ¨é‡å¯åä½ ä¹Ÿä¸éœ€è¦é‡æ–°è¾“å…¥å¯†ç çŸ­è¯­ã€‚

#### è‡ªåŠ¨å¯åŠ¨ `ssh-agent`
ä¸ºäº†ç¡®ä¿ `ssh-agent` åœ¨æ¯æ¬¡æ‰“å¼€ç»ˆç«¯æ—¶éƒ½èƒ½è‡ªåŠ¨å¯åŠ¨ï¼Œä½ å¯ä»¥å°†ä¸Šé¢çš„å‘½ä»¤æ·»åŠ åˆ°ä½ çš„ shell é…ç½®æ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚ `.bashrc`, `.zshrc` æˆ–è€… `.profile`ï¼‰ã€‚

### 2. ä½¿ç”¨æ— å¯†ç çŸ­è¯­çš„å¯†é’¥
å¦‚æœä½ ä¸ä»‹æ„ç¨å¾®é™ä½å®‰å…¨æ€§ï¼Œå¯ä»¥é€‰æ‹©ç”Ÿæˆä¸€ä¸ªæ–°çš„æ²¡æœ‰å¯†ç çŸ­è¯­çš„ SSH å¯†é’¥ã€‚è¿™å°†å…è®¸ä½ åœ¨æ²¡æœ‰ä»»ä½•æç¤ºçš„æƒ…å†µä¸‹ä½¿ç”¨è¯¥å¯†é’¥ã€‚

```bash
ssh-keygen -t rsa -b 4096 -C "your_email@example.com" -N ""
# -N "" è¡¨ç¤ºä¸è®¾ç½®å¯†ç çŸ­è¯­
```

ç„¶åå°†è¿™ä¸ªæ–°çš„å…¬é’¥æ·»åŠ åˆ°ä½ çš„ GitHub è´¦æˆ·ä¸­ï¼Œå¹¶æ›´æ–°æœ¬åœ° Git é…ç½®æ¥ä½¿ç”¨è¿™ä¸ªæ–°å¯†é’¥ã€‚

### 3. ä½¿ç”¨ Keychain Access
macOS æä¾›äº†ä¸€ä¸ªåä¸º Keychain Access çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ ç®¡ç†å„ç§å¯†ç ã€‚ä½ å¯ä»¥å°† SSH å¯†é’¥æ·»åŠ åˆ° Keychain ä¸­ï¼Œè¿™æ ·ç³»ç»Ÿå°±ä¼šè®°ä½å¯†ç çŸ­è¯­ã€‚

1. æ‰“å¼€ Keychain Access åº”ç”¨ç¨‹åºã€‚
2. é€‰æ‹©å·¦ä¾§çš„â€œç™»å½•â€é”®é“¾ã€‚
3. é€‰æ‹©èœå•æ ä¸­çš„ â€œKeychain Accessâ€ -> â€œPreferences...â€ã€‚
4. å‹¾é€‰ â€œShow keychain status in menu barâ€ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä»èœå•æ å¿«é€Ÿè®¿é—® Keychainã€‚
5. ä½¿ç”¨ `ssh-add -K ~/.ssh/id_rsa` å°†å¯†é’¥æ·»åŠ åˆ° Keychainã€‚
6. å½“ç³»ç»Ÿæç¤ºè¾“å…¥å¯†ç çŸ­è¯­æ—¶ï¼Œå‹¾é€‰â€œåœ¨é’¥åŒ™ä¸²ä¸­è®°ä½å¯†ç â€ã€‚

é€šè¿‡ä»¥ä¸Šæ–¹æ³•ä¹‹ä¸€ï¼Œä½ åº”è¯¥èƒ½å¤Ÿé¿å…æ¯æ¬¡æ¨é€ä»£ç æ—¶éƒ½éœ€è¦è¾“å…¥å¯†ç çŸ­è¯­ã€‚ä¸è¿‡ï¼Œè¯·æ³¨æ„ï¼Œè™½ç„¶è¿™äº›æ–¹æ³•æé«˜äº†ä¾¿åˆ©æ€§ï¼Œä½†å¯èƒ½ä¼šé™ä½ä¸€å®šçš„å®‰å…¨æ€§ã€‚ç¡®ä¿ä½ äº†è§£è¿™äº›é£é™©ï¼Œå¹¶æ ¹æ®ä½ çš„å®‰å…¨éœ€æ±‚åšå‡ºé€‚å½“çš„é€‰æ‹©ã€‚

---

```bash
$ ssh-add -K ~/.ssh/id_rsa
WARNING: The -K and -A flags are deprecated and have been replaced
         by the --apple-use-keychain and --apple-load-keychain
         flags, respectively.  To suppress this warning, set the
         environment variable APPLE_SSH_ADD_BEHAVIOR as described in
         the ssh-add(1) manual page.
```

è¿™ä¸ªè­¦å‘Šä¿¡æ¯è¡¨æ˜ï¼Œ`ssh-add` å‘½ä»¤ä¸­çš„ `-K` å’Œ `-A` é€‰é¡¹å·²ç»è¿‡æ—¶ï¼Œå®ƒä»¬å·²ç»è¢«æ›¿æ¢ä¸º `--apple-use-keychain` å’Œ `--apple-load-keychain` é€‰é¡¹ã€‚

---

```bash
$ ssh-add --apple-use-keychain ~/.ssh/id_rsa
```